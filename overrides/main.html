{% extends "base.html" %}

{% block htmltitle %}
<title>{% if page.title %}{{ page.title }} - {% endif %}{{ config.site_name }}</title>
{% endblock %}

{% block extrahead %}
<!-- Google tag (gtag.js) - Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-GFX72HCYMH"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-GFX72HCYMH');
</script>

<!-- Include comprehensive meta tags -->
{% include "partials/meta.html" %}

<!-- Fonts - Optimized with font-display swap -->
<link rel="preconnect" href="https://fonts.googleapis.com"/>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500;700&display=swap" rel="stylesheet" media="print" onload="this.media='all'"/>

<!-- Material Symbols - Async load -->
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet" media="print" onload="this.media='all'"/>

<!-- Custom Tailwind-like utilities for production -->
<link rel="stylesheet" href="{{ 'stylesheets/css/tailwind-custom.css' | url }}"/>
{% endblock %}

{% block styles %}
{{ super() }}
<link rel="stylesheet" href="{{ 'stylesheets/notebook-enhanced.css' | url }}">
{% endblock %}

{% block site_name %}
<script>
  (function() {
    'use strict';
    
    function updateSiteName() {
      requestAnimationFrame(() => {
        const activeTab = document.querySelector('.md-tabs__link--active');
        const siteNameElement = document.querySelector('.md-header__title');
        
        if (activeTab && siteNameElement) {
          const activeTabName = activeTab.textContent.trim();
          const titleLink = siteNameElement.querySelector('.md-header__ellipsis');
          if (titleLink && titleLink.textContent !== activeTabName) {
            titleLink.textContent = activeTabName;
          }
        }
      });
    }
    
    // Run on load
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', updateSiteName, { once: true });
    } else {
      updateSiteName();
    }
    
    // Handle instant navigation
    if (typeof app !== 'undefined' && app.document$) {
      app.document$.subscribe(updateSiteName);
    }
  })();
</script>
{% endblock %}

{% block scripts %}
{{ super() }}
<script src="{{ 'javascripts/notebook-enhanced.js' | url }}"></script>
{% endblock %}
